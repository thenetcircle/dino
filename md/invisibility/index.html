<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Invisibility - Dino</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Invisibility";
        var mkdocs_page_input_path = "md\\invisibility.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> Dino
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../installation/">Installation</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../getting_started/">Getting Started</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="./">Invisibility</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#using-the-rest-api-for-invisible-login">Using the REST api for invisible login</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#using-the-ws-api-for-invisible-login">Using the WS api for invisible login</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#changing-status-to-invisible-while-online">Changing status to invisible while online</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#using-the-ws-api-for-visible-login">Using the WS api for visible login</a>
    </li>
    </ul>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../usage/">Usage</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../api/">API</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../web/">Web UI API</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../events/">Events</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../external_events/">External Events</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../acl/">ACL</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../rest/">REST</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../wio/">Who Is Online?</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../storage/">Storage</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">Dino</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a> &raquo;</li>
      <li class="breadcrumb-item active">Invisibility</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h2 id="invisibility">Invisibility</h2>
<p>There are multiple ways to change visibility status, either explicitly using the status api, or implicitly using the 
login api:</p>
<ul>
<li>REST API <a href="../rest/#post-status"><code>/status</code></a>,</li>
<li>WS API <a href="../api/#status"><code>status</code></a>,</li>
<li>WS API <a href="../api/#login"><code>login</code></a>.</li>
</ul>
<p>When doing an invisible login, the <code>last_online_at</code> should not be updated, and the user status in the cache should be 
<code>3</code> (invisible, see <a href="../wio/">the WIO docs</a> for more info). There are however ways to force a different behavior; see 
below.</p>
<h3 id="using-the-rest-api-for-invisible-login">Using the REST api for invisible login</h3>
<p>To do an invisible login, you can either call the <a href="../rest/#post-status"><code>REST API /status</code></a> first (before login),
with the <code>stage</code> parameter set to <code>login</code> (instead of the default <code>status</code>), then call this WS API normally to login 
(without <code>actor.summary: 'login'</code>). The user will then be invisible <em>before</em> he/she logs in, and the <code>last_online_at</code>
will not be updated.</p>
<p>The REST api request would look as follows:</p>
<pre><code class="language-json">{   
    &quot;id&quot;: &quot;&lt;user ID&gt;&quot;,
    &quot;status&quot;: &quot;invisible&quot;,
    &quot;stage&quot;: &quot;login&quot;
}   
</code></pre>
<p><strong>Note: if <code>stage</code> is set to <code>status</code> instead of <code>login</code>, then <code>last_online_at</code> <em>will</em> be updated.</strong></p>
<p>Next, the WS login request would look as follows:</p>
<pre><code class="language-json">{
    &quot;verb&quot;: &quot;login&quot;,
    &quot;actor&quot;: {
        &quot;id&quot;: &quot;5666&quot;,
        &quot;displayName&quot;: &quot;Zm9vYmFy&quot;,
        &quot;attachments&quot;: [{
            &quot;objectType&quot;: &quot;token&quot;,
            &quot;content&quot;: &quot;some-token&quot;
        }]
    }
}
</code></pre>
<p>Now the user has logged in invisibly. </p>
<p><strong>Note: There's no need for <code>actor.summary: 'login'</code> here, since we already set the user to invisibly using the rest
API before the user logged in.</strong></p>
<p><strong>Note: There's no need to call the WS <code>status</code> API now, the user is already invisible, but there's no harm in doing it, 
as long as <code>actor.summary</code> is set to <code>login</code>.</strong></p>
<p>For example:</p>
<pre><code class="language-json">{
    &quot;verb&quot;: &quot;invisible&quot;,
    &quot;actor&quot;: {
        &quot;summary&quot;: &quot;login&quot;
    }
}
</code></pre>
<h3 id="using-the-ws-api-for-invisible-login">Using the WS api for invisible login</h3>
<p>The other option is to set <code>actor.content</code> to <code>invisible</code> in the WS login request, in which case there's no need to 
call the REST api. The REST api approach is preferred though, since only paying users should be allowed to be invisible, 
so by using the REST api, the community backend can check the membership status before setting a user invisible. When 
using the WS api for this, there's no validation if the user is allowed to be invisible or not, and a user could alter 
the request on client side to circumvent the restriction.</p>
<p>Invisible login using the WS <code>login</code> api looks are follows:</p>
<pre><code class="language-json">{
    &quot;verb&quot;: &quot;login&quot;,
    &quot;actor&quot;: {
        &quot;id&quot;: &quot;5666&quot;,
        &quot;displayName&quot;: &quot;Zm9vYmFy&quot;,
        &quot;content&quot;: &quot;invisible&quot;,
        &quot;attachments&quot;: [{
            &quot;objectType&quot;: &quot;token&quot;,
            &quot;content&quot;: &quot;some-token&quot;
        }]
    }
}
</code></pre>
<p>Now the user has logged in invisibly. </p>
<p><strong>Note: There's no need to call the WS <code>status</code> API now, the user is already invisible, but there's no harm in doing it, 
as long as <code>actor.summary</code> is set to <code>login</code>.</strong></p>
<p>For example:</p>
<pre><code class="language-json">{
    &quot;verb&quot;: &quot;invisible&quot;,
    &quot;actor&quot;: {
        &quot;summary&quot;: &quot;login&quot;
    }
}
</code></pre>
<h3 id="changing-status-to-invisible-while-online">Changing status to invisible while online</h3>
<p>When a user is online, and wants to change his/her status to <code>invisible</code>, the WS api <code>status</code> can be used.</p>
<p>The request looks as follows:</p>
<pre><code class="language-json">{
    &quot;verb&quot;: &quot;invisible&quot;
}
</code></pre>
<p>The user will now become invisible, and the <code>last_online_at</code> will be updated to this time. A fake <code>gn_user_disconnected</code> 
event will be sent to relevant users.</p>
<p><strong>Note: If the request contains <code>actor.summary: "login"</code>, then <code>last_online_at</code> <em>will not</em> be updated. Thus, when a user is 
already online, don't set the <code>summary</code> to <code>login</code>; you can leave it out of the request, or set it to <code>status</code>.</strong></p>
<h3 id="using-the-ws-api-for-visible-login">Using the WS api for visible login</h3>
<p>If a user is <em>not</em> logging is as <code>invisible</code>, the WS <code>status</code> api should be called anyway, in case the user was 
invisible the last time he/she logged out. This will update the necessary statuses, e.g. <code>last_online_at</code>.</p>
<p>The WS <code>login</code> request would look as follows:</p>
<pre><code class="language-json">{
    &quot;verb&quot;: &quot;login&quot;,
    &quot;actor&quot;: {
        &quot;id&quot;: &quot;5666&quot;,
        &quot;displayName&quot;: &quot;Zm9vYmFy&quot;,
        &quot;attachments&quot;: [{
            &quot;objectType&quot;: &quot;token&quot;,
            &quot;content&quot;: &quot;some-token&quot;
        }]
    }
}
</code></pre>
<p>Note that the request does not contain the <code>actor.content</code> field, so the login will default to <code>visible</code>. Though, if 
the user was previously invisible, the user will now be online but invisible again, to preserve the visibility status. 
To change to visible, we'll call the <code>status</code> api below.</p>
<p>Next, call the WS <code>status</code> api:</p>
<pre><code class="language-json">{
    &quot;verb&quot;: &quot;online&quot;,
    &quot;actor&quot;: {
        &quot;summary&quot;: &quot;login&quot;
    }
}
</code></pre>
<p><strong>Note: the <code>summary</code> field is not required when setting a user <code>online</code>, so it can be omitted, but it's okay to 
specify it too, as long as it's set to <code>login</code>.</strong></p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../getting_started/" class="btn btn-neutral float-left" title="Getting Started"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../usage/" class="btn btn-neutral float-right" title="Usage">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../getting_started/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../usage/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
