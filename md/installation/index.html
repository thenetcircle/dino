<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Installation - Dino</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Installation";
    var mkdocs_page_input_path = "md/installation.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Dino</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../..">Home</a>
	    </li>
          
            <li class="toctree-l1 current">
		
    <a class="current" href="./">Installation</a>
    <ul class="subnav">
            
    <li class="toctree-l2"><a href="#requirements">Requirements</a></li>
    
        <ul>
        
            <li><a class="toctree-l3" href="#from-source">From source</a></li>
        
            <li><a class="toctree-l3" href="#using-miniconda">Using MiniConda</a></li>
        
            <li><a class="toctree-l3" href="#other-requirements">Other requirements</a></li>
        
        </ul>
    

    <li class="toctree-l2"><a href="#installing">Installing</a></li>
    
        <ul>
        
            <li><a class="toctree-l3" href="#simple">Simple</a></li>
        
            <li><a class="toctree-l3" href="#using-init-script">Using init script</a></li>
        
            <li><a class="toctree-l3" href="#using-the-supplied-install-script">Using the supplied install script</a></li>
        
            <li><a class="toctree-l3" href="#clustering">Clustering</a></li>
        
        </ul>
    

    <li class="toctree-l2"><a href="#running-the-application">Running the application</a></li>
    
        <ul>
        
            <li><a class="toctree-l3" href="#simple_1">Simple</a></li>
        
            <li><a class="toctree-l3" href="#using-the-deploy-script">Using the deploy script</a></li>
        
            <li><a class="toctree-l3" href="#running-in-docker">Running in Docker</a></li>
        
            <li><a class="toctree-l3" href="#running-in-kubernetes">Running in Kubernetes</a></li>
        
        </ul>
    

    <li class="toctree-l2"><a href="#monitoring">Monitoring</a></li>
    

    <li class="toctree-l2"><a href="#building-the-documentation">Building the documentation</a></li>
    

    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../getting_started/">Getting Started</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../usage/">Usage</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../api/">API</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../web/">Web UI API</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../events/">Events</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../external_events/">External Events</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../acl/">ACL</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../rest/">REST API</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../wio/">Who Is Online?</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../storage/">Storage</a>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Dino</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
    
    <li>Installation</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="requirements">Requirements</h1>
<p>Some package requirements (debian/ubuntu):</p>
<pre><code>$ sudo apt-get update
$ sudo apt-get install tar git curl nano wget dialog net-tools build-essential
$ sudo apt-get install libssl-dev libmysqlclient-dev libpq-dev virtualenv
</code></pre>
<h2 id="from-source">From source</h2>
<p>Requires Python &gt;=3.5.0. Download and install from source (tip: install in <code>/opt</code> since it might interfere with other
python installations, present or future):</p>
<pre><code>$ wget https://www.python.org/ftp/python/3.5.4/Python-3.5.4.tar.xz
$ tar -xvf Python-3.5.4.tar.xz
$ cd Python-3.5.4/
$ sudo mkdir /opt/python-3.5.4
$ ./configure --prefix=/opt/python-3.5.4 --enable-shared LDFLAGS="-Wl,-rpath /usr/local/lib" --enable-optimizations
$ make
$ sudo make altinstall
</code></pre>
<p>Add the paths to your <code>.bashrc</code> or <code>.profile</code>:</p>
<pre><code>export PATH="/opt/python-3.5.4/bin/:$PATH"
export LD_LIBRARY_PATH="/opt/python-3.5.4/lib/:$LD_LIBRARY_PATH"
</code></pre>
<p>Install requirements:</p>
<pre><code>$ source env/bin/activate
(env) $ pip install -r requirements.txt
</code></pre>
<h2 id="using-miniconda">Using MiniConda</h2>
<p>Install <a href="https://conda.io/docs/install/quick.html">miniconda</a>:</p>
<pre><code>$ wget https://repo.continuum.io/miniconda/Miniconda3-latest-Linux-x86_64.sh
$ bash Miniconda3-latest-Linux-x86_64.sh # assuming defaults accepted
$ source ~/.bashrc
</code></pre>
<p>Create your environment and install the requirements:</p>
<pre><code>$ conda create -n env python=3.5
$ source activate env
$ pip install -r requirements.txt
</code></pre>
<h2 id="other-requirements">Other requirements</h2>
<p>If you're using redis, postgresql/mysql and/or cassandra, please see relevant documentation for how to install:</p>
<ul>
<li><a href="https://www.digitalocean.com/community/tutorials/how-to-install-and-configure-redis-on-ubuntu-16-04">Redis</a></li>
<li><a href="https://www.digitalocean.com/community/tutorials/how-to-install-and-use-postgresql-on-ubuntu-16-04">PostgreSQL</a></li>
<li><a href="https://www.digitalocean.com/community/tutorials/how-to-install-mysql-on-ubuntu-14-04">MySQL</a></li>
<li><a href="https://www.digitalocean.com/community/tutorials/how-to-install-cassandra-and-run-a-single-node-cluster-on-ubuntu-14-04">Apache Cassandra</a></li>
</ul>
<h1 id="installing">Installing</h1>
<p>There are a few choices included for how to install Dino.</p>
<h2 id="simple">Simple</h2>
<p>Just clone and run from the cloned directory:</p>
<pre><code>$ git clone https://github.com/thenetcircle/dino.git
$ cd dino
$ virtualenv --python=python3.5 env
$ source env/bin/activate
(env) $ pip install --upgrade -r requirements.txt
(env) $ pip install --upgrade --no-deps .
</code></pre>
<h2 id="using-init-script">Using init script</h2>
<pre><code>$ git clone https://github.com/thenetcircle/dino.git foobar-prod
$ cd foobar-prod
$ virtualenv --python=python3.5 env
$ sudo cp bin/initd/dino-app /etc/init.d/
$ source env/bin/activate
(env) $ pip install --upgrade -r requirements.txt
(env) $ pip install --upgrade --no-deps .
</code></pre>
<p>Make sure to update the init script to use the correct paths.</p>
<h2 id="using-the-supplied-install-script">Using the supplied install script</h2>
<p>The install script will copy the systemd files to  <code>/usr/lib/systemd/system/</code>, one for each service/environment you 
install for.</p>
<pre><code>$ pwd
/home/dino
$ git clone https://github.com/thenetcircle/dino.git foobar-prod
$ cd foobar-prod
$ virtualenv --python=python3.5 env
$ sudo ./bin/install.sh foobar-prod /home/dino/foobar-prod app 5200
$ sudo ./bin/install.sh foobar-prod /home/dino/foobar-prod rest 5400
$ sudo ./bin/install.sh foobar-prod /home/dino/foobar-prod web 5300
$ source env/bin/activate
(env) $ pip install --upgrade -r requirements.txt
(env) $ pip install --upgrade --no-deps .
</code></pre>
<h2 id="clustering">Clustering</h2>
<p>If clustering dino, install a reverse proxy that supports websockets, e.g. nginx (&gt;= 1.4). Here's an example configuration:</p>
<pre><code>upstream gridnodes {
    ip_hash;

    server some-ip-or-host-1:5210;
    server some-ip-or-host-2:5210;
    server some-ip-or-host-3:5210;
    server some-ip-or-host-4:5210;
    server some-ip-or-host-5:5210;
    server some-ip-or-host-6:5210;
    server some-ip-or-host-7:5210;
    server some-ip-or-host-8:5210;
}

map $http_upgrade $connection_upgrade {
    default upgrade;
    '' close;
}

server {
    listen 5200;

    location / {
        access_log on;

        proxy_pass http://gridnodes;
        proxy_next_upstream error timeout invalid_header http_500;
        proxy_connect_timeout 2;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;

        # WebSocket support (nginx 1.4)
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
    }
}
</code></pre>
<h1 id="running-the-application">Running the application</h1>
<p>A few examples are included for running Dino: running in the foreground, using systemd and the deploy script, docker and
lastly kubernetes.</p>
<h2 id="simple_1">Simple</h2>
<p>Running in the foreground:</p>
<pre><code>$ cd dino/
$ virtualenv --python=python3.5 env
$ source env/bin/activate
(env) $ DINO_ENVIRONMENT=dev gunicorn \
            --error-logfile ~/dino-gunicorn-error.log \
            --log-file ~/dino-gunicorn.log \
            --worker-class eventlet \
            --threads 1 \
            --worker-connections 5000 \
            --workers 1 \
            --bind 0.0.0.0:5210 \
            app:app
</code></pre>
<p>To run the rest API and admin interface use the same command but change <code>app:app</code> to <code>rest:app</code> and <code>web:app</code> 
respectively.</p>
<h2 id="using-the-deploy-script">Using the deploy script</h2>
<p>The simple deployment script included pulls from git master, shuts down services, clears online tables then starts
everything up again. The script assumes the base directory where the project is checked out has the same name as the
<code>environment</code>. The deployment script also assumes you're running with <code>systemd</code> and have used the installation script
to first install Dino. The deployment script will deploy for all services that are installed for the environment, so if
you've only installed the <code>app</code> and <code>rest</code> service but not the <code>web</code> service, then only the <code>app</code> and <code>rest</code> service 
will be re-deployed.</p>
<p>So if you're environment is called <code>foobar-prod</code>:</p>
<pre><code>$ cd /home/dino/foobar-prod
$ DINO_ENVIRONMENT=foobar-prod DINO_HOME=/home/dino/foobar-prod ./bin/deploy-simple.sh 
starting deployment...
pulling from git... 
Already up-to-date.
stopping web... 
stopping rest... 
stopping app... 
clearing online cache... 
clearing online db tables... 
starting app... 
starting rest... 
starting web... 
deployment done!
</code></pre>
<h2 id="running-in-docker">Running in Docker</h2>
<p>First create the image:</p>
<pre><code>sudo docker build -t dino .
</code></pre>
<p>Then we can run it (create an environments file in secrets/ for your chosen environment (dev/prod/etc), e.g. 
<code>secrets/dev.env</code>. Check the <code>secrets/default.env</code> for an example. Then we can run the image:</p>
<pre><code>sudo docker run --env-file=secrets/dev.env --env DINO_PORT=5120 -t dino
</code></pre>
<p>Note that we didn't put the port in the <code>dev.env</code> file (though we could), because if starting multiple dino nodes they
need to use different ports.</p>
<h2 id="running-in-kubernetes">Running in Kubernetes</h2>
<p>For running in Kubernetes we need to use Kubernetes <code>Secrets</code> instead of the <code>.env</code> files. Example configuration for 
some secret values for your pod:</p>
<pre><code>apiVersion: v1
kind: Pod
metadata:
  name: secret-env-pod
spec:
  containers:
    - name: mycontainer
      image: redis
      env:
        - name: DINO_DB_HOST
          valueFrom:
            secretKeyRef:
              name: dev-secrets
              key: db-host
        - name: DINO_DB_USER
          valueFrom:
            secretKeyRef:
              name: dev-secrets
              key: db-user
  restartPolicy: Never
</code></pre>
<p>Read more on Kubernetes website on <a href="https://kubernetes.io/docs/user-guide/secrets/#creating-your-own-secrets">how to create the secrets object</a> 
and then how to <a href="https://kubernetes.io/docs/user-guide/secrets/#using-secrets-as-environment-variables">configure your pod to use it</a>.</p>
<h1 id="monitoring">Monitoring</h1>
<p>Dino can be extensively monitored by configuring a <code>statsd</code> endpoint. In <code>dino.yaml</code> you can either choose <code>mock</code> to disable metrics:</p>
<pre><code>stats:
  type: 'statsd'
  host: 'mock'
</code></pre>
<p>Or choose <code>statsd</code> with a host and port to publish all metrics to a <code>statsd</code> host, for example like this:</p>
<pre><code>stats:
  type: 'statsd'
  host: '$DINO_STATSD_HOST'
  port: 8125
  prefix: 'dino.myapp'
  include_hostname: 'true'
</code></pre>
<p>If you choose <code>true</code> for <code>include_hostname</code> (good when running multiple nodes on different physical machines, in this example
it's <code>skybox-04</code>) then the value of <code>import socket; socket.gethostname()</code> will be added <em>after</em> the value supplied for <code>prefix</code>.
So in the example above, when the mean timer value of the metric for how long time the api action <code>on_login</code> takes would be:</p>
<pre><code>dino.myapp.skybox-04.event.on_login.timer.mean
</code></pre>
<p>An already configured solution for <code>statsd</code> with <code>influxdb</code> and the <code>grafana</code> frontend exists with
<a href="https://github.com/advantageous/docker-grafana-statsd">the following docker image</a>:</p>
<pre><code>docker run -d \
  --name grafana \
  -p 3003:9000 \
  -p 3004:8083 \
  -p 8086:8086 \
  -p 22022:22 \
  -p 8125:8125/udp \
  advantageous/grafana:latest:latest
</code></pre>
<p>And configure the <code>statsd</code> host to the IP you run the docker image on, and the port <code>8125</code>. Example of enabling this <code>statsd</code>
host with this docker image running:</p>
<p><a href="https://raw.githubusercontent.com/thenetcircle/dino/master/docs/dino-grafana.png"><img alt="Dino Grafana" src="https://raw.githubusercontent.com/thenetcircle/dino/master/docs/dino-grafana.png" /></a></p>
<h1 id="building-the-documentation">Building the documentation</h1>
<p>Viewing locally:</p>
<pre><code>$ mkdocs serve
</code></pre>
<p>Building the site (not necessary):</p>
<pre><code>$ mkdocs build
</code></pre>
<p>Deploy to gihub pages:</p>
<pre><code>$ mkdocs gh-deploy
</code></pre>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../getting_started/" class="btn btn-neutral float-right" title="Getting Started">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../.." class="btn btn-neutral" title="Home"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../.." style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../getting_started/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>

</body>
</html>
