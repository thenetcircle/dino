<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Getting Started - Dino</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Getting Started";
    var mkdocs_page_input_path = "md/getting_started.md";
    var mkdocs_page_url = "/md/getting_started/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Dino</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../..">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../installation/">Installation</a>
	    </li>
          
            <li class="toctree-l1 current">
		
    <a class="current" href="./">Getting Started</a>
    <ul class="subnav">
            
    <li class="toctree-l2"><a href="#quick-start">Quick start</a></li>
    

    <li class="toctree-l2"><a href="#encoding">Encoding</a></li>
    

    <li class="toctree-l2"><a href="#authentication">Authentication</a></li>
    

    <li class="toctree-l2"><a href="#private-messaging">Private messaging</a></li>
    

    <li class="toctree-l2"><a href="#java-client">Java client</a></li>
    

    <li class="toctree-l2"><a href="#delivery-acknowledgment">Delivery acknowledgment</a></li>
    

    <li class="toctree-l2"><a href="#limited-sessions">Limited sessions</a></li>
    

    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../usage/">Usage</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../api/">API</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../web/">Web UI API</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../events/">Events</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../external_events/">External Events</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../acl/">ACL</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../rest/">REST API</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../wio/">Who Is Online?</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../storage/">Storage</a>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Dino</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
    
    <li>Getting Started</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h2 id="quick-start">Quick start</h2>
<p>This example is using JavaScript.</p>
<p>First we connect to the server:</p>
<pre><code class="javascript">socket = io.connect(
    'http://' + document.domain + ':' + location.port + '/chat', 
    {transports:['websocket']}
);
</code></pre>

<p>We'll receive a <code>connect</code> event back after successfully connecting. Now we have to send the <code>login</code> event to provide the
server with some extra user information and to do authentication:</p>
<pre><code class="javascript">socket.on('connect', function() {
    socket.emit('login', {
        verb: 'login',
        actor: {
            id: '&lt;user ID&gt;',
            attachments: [
                {
                    objectType: 'token',
                    content: '&lt;auth token&gt;'
                }
            ]
        }
    });
});
</code></pre>

<p>All events sent to the server will get a response with the same name plus a prefix of <code>gn_</code>. For example, the login 
event sent above will get the following response, <code>gn_login</code>, meaning we've successfully authenticated with the server.
Now we can start joining rooms, chatting, sending events etc.</p>
<pre><code class="javascript">socket.on('gn_login', function(response) {
    socket.emit('list_channels', {
        verb: 'list'
    });
});
</code></pre>

<p>The response from the server will be in JSON format. If no data is expected for the events, only a status code will be
in the response. For example, sending the <code>join</code> event to join a room won't return any data, but only the following
(if successful):</p>
<pre><code class="json">{
    &quot;status_code&quot;: 200
}
</code></pre>

<p>Failure to execute an event on the server will return an <a href="../api/#error-codes">error code</a>:</p>
<pre><code class="json">{
    &quot;status_code&quot;: 423,
    &quot;data&quot;: &quot;&lt;an error message, always a string&gt;&quot;
}
</code></pre>

<p>If an internal server error occurs, code 500 is returned:</p>
<pre><code class="json">{
    &quot;status_code&quot;: 500,
    &quot;data&quot;: &quot;&lt;an error message, always a string&gt;&quot;
}
</code></pre>

<p>The format of the response can be configured, e.g. to return key "error" for error messages and use "data" only for json
data.</p>
<p>For events that contains data in the response, for example when sending the event <code>list_channels</code>, we expect to get a list
of channels in the response. For these events the data part is always a JSON in the ActivityStreams 1.0 format:</p>
<pre><code class="javascript">{
    &quot;status_code&quot;: 200,
    &quot;data&quot;: {       
        &quot;object&quot;: {
            &quot;objectType&quot;: &quot;channels&quot;
            &quot;attachments&quot;: [
                {
                    &quot;id&quot;: &quot;&lt;channel ID 1&gt;&quot;,
                    &quot;content&quot;: &quot;&lt;channel name 1 in base64&gt;&quot;
                },
                {
                    &quot;id&quot;: &quot;&lt;channel ID 2&gt;&quot;,
                    &quot;content&quot;: &quot;&lt;channel name 2 in base64&gt;&quot;
                },
                {
                    &quot;id&quot;: &quot;&lt;channel ID 3&gt;&quot;,
                    &quot;content&quot;: &quot;&lt;channel name 3 in base64&gt;&quot;
                }
            ]
        },
        &quot;verb&quot;: &quot;list&quot;
    }
}
</code></pre>

<h2 id="encoding">Encoding</h2>
<p>All user names, room names, channel names and chat messages are expected to be base64 encoded unicode strings. All
responses and events originating from the server will also follow this practice, so when listing rooms/channels/users
all names will always be in base64.</p>
<h2 id="authentication">Authentication</h2>
<p>If the <code>redis</code> authentication method is configured, then when clients send the <code>login</code> event to the server, the
supplied <code>token</code> and <code>actor.id</code> parameter must already exist in Redis. When the server gets the login event it will
check if the token matches the one stored in Redis for this user ID, otherwise it will not authenticate the session.</p>
<p>Therefor, before a client can login, these two values (and any other possible values used for permissions) needs to
first be set in the Redis <code>hset</code> with key <code>user:auth:&lt;user ID&gt;</code>.</p>
<p>Example:</p>
<pre><code>$ redis-cli
127.0.0.1:6379&gt; hset user:auth:1234 token 302fe6be-a72f-11e6-b5fc-330653beb4be
127.0.0.1:6379&gt; hset user:auth:1234 age 35
127.0.0.1:6379&gt; hset user:auth:1234 gender m
</code></pre>
<h2 id="private-messaging">Private messaging</h2>
<p>Sometimes private messaging should be identified by the unique combination of two user IDs, say <code>1</code> and <code>2</code>, so
that the history between them can be accesses by both parties. In this case, the client implementation should
generate an identifiable "name" for this combination, and create a room to group these messages in. </p>
<p>For example, the implementer generates a <code>thread_id</code> or <code>conversation_id</code> on their side, then call the
<a href="../api/#create"><code>create</code></a> API with the name set as this generated ID. For example, if the ID <code>42</code> is generated 
for the conversation assiciated with the users <code>1</code> and <code>2</code>:</p>
<pre><code class="javascript">socket.emit('create', {
    verb: 'create'
    object: {
        url: '&lt;channel uuid&gt;'
    },
    target: {
        displayName: '42',
        objectType: 'private',
        attachments: [{
            objectType: 'owners',
            summary: '1,2'
        }]
    }
}, function(status_code, data, error_msg) {
    // callback method, check create api for format of the data param
});
</code></pre>

<p>The callback method will contain the generated UUID of this room (e,g, <code>4b90eae8-c82b-11e7-98ba-43d525dbbb29</code>), 
which should be used when joining, sending message etc. It is the responsibility of the implementer to keep track 
of the room IDs associated with conversations.</p>
<p>All users specied as the "owners" will receive the <a href="../events/#a-new-room-is-created"><code>gn_room_created</code></a> event if 
they are online, otherwise they would get it as history later.</p>
<p>To send a message in this <code>room</code>, first <a href="../api/#join"><code>join</code></a> the room (will return the history of this room):</p>
<pre><code class="javascript">socket.emit('join', {
    verb: 'join',
    target: {
        id: '4b90eae8-c82b-11e7-98ba-43d525dbbb29'
    }
}, function(status_code, data, error_msg) {
    // callback method
});
</code></pre>

<p>Alternatively, a room can be joined by the <code>display_name</code> instead of by <code>id</code>, in case that the UUID is not known
on the client side a the time of joining. If multiple rooms exists with the same <code>display_name</code>, the <code>join</code> event 
will fail with the <a href="../api/#error-codes">error code 715</a>, though in reality that should not happen unless the
uniqueness of room names per channel during creation has been disabled. </p>
<p>Example of joining using <code>display_name</code>:</p>
<pre><code class="javascript">socket.emit('join', {
    verb: 'join',
    target: {
        display_name: '42'
    }   
}, function(status_code, data, error_msg) {
    // callback method, generated room uuid is data.target.id
});
</code></pre>

<p>Use the <a href="../api/#message"><code>message</code></a> API to send a message to this room:</p>
<pre><code class="javascript">socket.emit('message', {
    verb: 'send',
    target: {
        id: '4b90eae8-c82b-11e7-98ba-43d525dbbb29',
    },
    object: {
        content: '&lt;the message, base64 encoded&gt;',
    }
}, function(status_code, data, error_msg) {
    // callback method
});
</code></pre>

<p>If the other user is online, he/she will get the <a href="../events/#message-received">message received</a> event.</p>
<h2 id="java-client">Java client</h2>
<p>Using the <a href="https://github.com/socketio/socket.io-client-java">Java socket.io library</a>, you have to use <code>http</code> 
instead of <code>ws</code> and <code>https</code> instead of <code>wss</code> (it's the same thing).</p>
<p>Create your object and use Gson to serialize it to json for a JSONObject (you cannot do a <code>toString</code> of the 
obejct, it needs to be a json object):</p>
<pre><code class="java">Gson gson = new Gson();
try {
    JSONObject obj = new JSONObject(gson.toJson(o));
    s.emit(&quot;login&quot;, obj);
} catch (JSONException e) {
    e.printStackTrace();
}
</code></pre>

<h2 id="delivery-acknowledgment">Delivery acknowledgment</h2>
<p>All APIs will invoke the callback (if specified) with a <code>status_code</code> and possibly <code>error_message</code> (if any 
errors). These should be be retrieved in the callback defined on the client side. If there was no error, the<br />
second argument will be nil. Examples of callbacks on client side in JavaScript:</p>
<pre><code class="javascript">socket.emit('message', '&lt;omitted json message&gt;', function(status_code, error_msg) {
    // do something
});  
</code></pre>

<p>Messages should also be awknowledged by the client when <a href="../api/#received">received</a>. An awknowledgement can also 
be sent by the client when a messages as been <a href="../api/#read">read</a>, to let other clients know if the message has 
been seen or not.</p>
<p>Unawknowledged (no received ack sent by client) messages will in future version be redelivered since it might
indicate a loss during transmission.</p>
<p>Example of sending acknowledgement of received message as well as listening for the <code>OK</code> server response to
the ack:</p>
<pre><code class="javascript">socket.on('gn_message', function(response) {
    if (response.status_code !== 200) {
        // handle error some way
        return;
    }

    // acknowledge that we got the message
    socket.emit('received', {
        verb: 'receive',
        target: {
            id: room_id
        },
        object: {
            attachments: [{
                // response.data.id is the generated uuid of the message, see api docs
                id: response.data.id
            }]
        }
    }, function(status_code, error_msg) {
        // server &quot;acks our ack&quot;
        console.log('callback for received api: ' + status_code)
    });

    // finally handle the message
    handle_message(data);
});
</code></pre>

<h2 id="limited-sessions">Limited sessions</h2>
<p>The session handler can be configured to either allow only one simultaneous connection per user or
an unlimited amount. If only one session is allowed, then whenever a new session by the same user
is started, the previous connection will be disconnected.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../usage/" class="btn btn-neutral float-right" title="Usage">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../installation/" class="btn btn-neutral" title="Installation"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../installation/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../usage/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js"></script>
      <script src="../../search/require.js"></script>
      <script src="../../search/search.js"></script>

</body>
</html>
